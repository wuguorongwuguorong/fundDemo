{{#extends "base"}}

{{#block "content"}}
<h2 class="mt-3">Agent Commissions</h2>

<form method="GET" class="row g-3 mb-3">
  <div class="col-md-4">
    <label class="form-label">Agent</label>
    <select name="agent_id" class="form-control" required>
      <option value="">-- Select Agent --</option>
      {{#each agents}}
        <option value="{{this.agent_id}}" {{#if (eq this.agent_id ../selectedAgentId)}}selected{{/if}}>
          {{this.full_name}} 
        </option>
      {{/each}}
    </select>
  </div>

  <div class="col-md-2">
    <label class="form-label">Rate (%)</label>
    <input type="number" step="0.01" min="0" name="rate" class="form-control" value="{{filters.rate}}" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">Start Date</label>
    <input type="date" name="from" class="form-control" value="{{filters.from}}" required />
  </div>

  <div class="col-md-3">
    <label class="form-label">End Date</label>
    <input type="date" name="to" class="form-control" value="{{filters.to}}" required />
  </div>

  <div class="col-12 d-flex align-items-end">
    <button class="btn btn-primary me-2" type="submit">Calculate</button>
    <a class="btn btn-secondary" href="/agents/commissions">Reset</a>
  </div>
</form>

{{#if selectedAgentId}}
  {{#if rows.length}}
    <table class="table">
      <thead>
        <tr>
          <th>Customer</th>
          <th>Customer ID</th>
          <th class="text-end">Total Invested</th>
          <th class="text-end">Commission ({{filters.rate}}%)</th>
        </tr>
      </thead>
      <tbody>
        {{#each rows}}
        <tr>
          <td>{{this.customer_name}}</td>
          <td>{{this.cust_id}}</td>
          <td class="text-end">{{this.total_invested}}</td>
          <td class="text-end">{{this.commission}}</td>
        </tr>
        {{/each}}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="2" class="text-end">Grand Totals</th>
          <th class="text-end">{{../summary.grand_invest}}</th>
          <th class="text-end">{{../summary.grand_commission}}</th>
        </tr>
      </tfoot>
    </table>
  {{else}}
    <div class="alert alert-info">No Pnotes match your filters for this agent.</div>
  {{/if}}
{{/if}}
{{/block}}

{{/extends}}
